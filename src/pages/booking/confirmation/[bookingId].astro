---
export const prerender = false;

import PageLayout from '@/components/layout/PageLayout.astro';
import Container from '@/components/layout/Container.astro';
import { BookingConfirmation } from '@/components/checkout/BookingConfirmation';
import Breadcrumbs from '@/components/seo/Breadcrumbs.astro';
import { liteAPIClient } from '@/lib/liteapi/client';

const { bookingId } = Astro.params;

let bookingDetails: any = null;
let error: string | null = null;

if (bookingId) {
  try {
    bookingDetails = await liteAPIClient(`/bookings/${bookingId}`, { method: 'GET' });
  } catch (err) {
    console.error('[Confirmation] Error fetching booking:', err);
    error = 'Could not load booking details';
  }
}
---

<PageLayout
  title="Booking Confirmation"
  description="Your booking has been confirmed"
  noindex={true}
>
  <Container class="py-16 lg:py-20">
    <Breadcrumbs items={[
      { label: 'Home', href: '/' },
      { label: 'Booking Confirmation', href: undefined },
    ]} />
    
    {error ? (
      <div class="max-w-2xl mx-auto text-center py-12">
        <p class="text-red-600 mb-4">{error}</p>
        <a href="/lodging" class="text-primary-600 hover:text-primary-700 font-semibold">
          Back to Hotel Search
        </a>
      </div>
    ) : (
      <BookingConfirmation
        client:load
        bookingId={bookingId || ''}
        confirmationNumber={bookingDetails?.confirmation_number || bookingDetails?.booking_id}
        hotelName={bookingDetails?.hotel_name}
        checkIn={bookingDetails?.checkin}
        checkOut={bookingDetails?.checkout}
      />
    )}
  </Container>
</PageLayout>
