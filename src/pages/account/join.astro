---
export const prerender = false;
import PageLayout from '@/components/layout/PageLayout.astro';
import Container from '@/components/layout/Container.astro';
import { AccountSignup } from '@/components/account/AccountSignup';
import { getSessionFromRequest } from '@/lib/auth';
import { getImagesByCategory } from '@/lib/image-library';
import { optimizePexelsImage, generateSrcSet } from '@/lib/image-optimizer';

const session = await getSessionFromRequest(Astro.request);
if (session) {
  return Astro.redirect('/account');
}

const heroImages = getImagesByCategory('resort');
const heroImage = heroImages?.[0];
const heroImageUrl = heroImage
  ? optimizePexelsImage(heroImage.url, { width: 1920, quality: 85 })
  : null;
const heroSrcSet = heroImage
  ? generateSrcSet(heroImage.url, [640, 960, 1280, 1600, 1920])
  : null;
const heroImageAlt = heroImage
  ? `Telluride resort view by ${heroImage.photographer}`
  : 'Telluride mountains';
---

<PageLayout
  title="Create an Account | Telluride Ski Hotels"
  description="Unlock synced bookings, loyalty perks, and stress-free management for every Telluride stay."
>
  <div class="relative text-white">
    {heroImageUrl ? (
      <div class="absolute inset-0">
        <img
          src={heroImageUrl}
          srcset={heroSrcSet || undefined}
          sizes="100vw"
          alt={heroImageAlt}
          class="w-full h-full object-cover"
          loading="lazy"
        />
        <div class="absolute inset-0 bg-neutral-950/70 backdrop-blur-[1px]" />
      </div>
    ) : (
      <div class="absolute inset-0 bg-neutral-950" />
    )}

    <Container class="relative py-16 lg:py-32 pb-40 lg:pb-48 max-w-4xl space-y-5">
      <p class="text-sm uppercase tracking-[0.25em] text-white/80 font-semibold">Telluride insider access</p>
      <h1 class="text-4xl lg:text-6xl font-black tracking-tight">
        Sync every reservation. Keep every stay connected.
      </h1>
      <p class="text-lg text-white/80 max-w-3xl">
        Create a Telluride Ski Hotels account to convert guest bookings, store confirmations, and unlock lightning-fast checkout for every future trip.
      </p>
    </Container>
  </div>

  <Container class="-mt-32 lg:-mt-40 pb-24 space-y-8">
    <AccountSignup client:load />
    <div class="text-center text-sm text-neutral-600">
      Already have an account? <a href="/account/login" class="text-primary-600 font-semibold">Sign in</a>.
    </div>
  </Container>
</PageLayout>


